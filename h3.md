# h3 Nuuskija

## x) Lue ja tiivistä. 

### Popov 2024: Hacktricks: Wireshark tricks
https://book.hacktricks.xyz/generic-methodologies-and-resources/basic-forensic-methodology/pcap-inspection/wireshark-tricks#improve-your-wireshark-skills

- Statistics valikosta löytyy mm:
  - Resolved Addresses (port/transport, protokollat, MAC ja valmistajan tiedot jne)
  - Protocol Hierarchy (näyttää liikenteen jakautumisen eri protokollien välillä)
  - Conversations (listaa kaikki keskustelut eri laitteiden välillä)
  - Endpoints (näyttää kaikki kohdeosoitteet ja niiden datan)
  - DNS (kaapatut DNS-pyynnöt)
  - I/O Graph (kaapatun liikenteen visualisointi)

- Filtteröintiä voi tehdä esimerkiksi protokollan mukaan
- Ctrl+f (paketin sisältä tiedon etsiminen)

### Karvinen 2023: Find Hidden Web Directories - Fuzz URLs with ffuf
https://terokarvinen.com/2023/fuzz-urls-find-hidden-directories/

- Verkkopalvelimilla on usein piilotettuja hakemistoja (esim. /secret, /admin), joita ei linkitetä näkyvästi.
- Ffuf on työkalu, joka etsii piilotettuja hakemistoja automaattisesti.
  - Sanakirja taustalla mahdollisista kansioista.
  - Kannattaa irroittaa kone netistä työkalun käytön ajaksi.
  - Tutoriaali toimi myös Kalilla.

## a) Valitse valmis hyökkäys. 

Valitsin vsftpd backdoorin ja päätin kokeilla sitä  searchsploit:in kautta.

![22](https://github.com/user-attachments/assets/018bda6b-f809-4b90-bb22-2e817b278032)

Valitsin siitä pythonin koska sen voisin ajaa ilman msfconsolea. Kopioin moduulin koneelleni.

![23](https://github.com/user-attachments/assets/e2ace130-8bbe-42a2-8f88-40fe252de49d)

Sen jälkeen ajoin moduulin lisäten kohteen ip:numeron. Ensimmäinen yhteyskokeilu ei toiminut mutta toinen toimi.

![24](https://github.com/user-attachments/assets/49f817bd-d575-4d3b-bf71-76b26e2515fc)


## b) Sorsa. 

![25](https://github.com/user-attachments/assets/930352d1-69b2-43ac-b577-07b153ee9791)

Telnetlib käytetään Telnet-yhteyden muodostamiseen ja argparse mahdollistaa komentoriviparametrien käytön, jotta voit syöttää kohteen IP-osoitteen suoraan skriptiä suorittaessa.

![26](https://github.com/user-attachments/assets/4f6a5cd1-a19a-49df-8bd7-e991c9e6b7ae)

Tässä kerrotaan, että otetaan vastaan kohteen IP-osoitteen komentoriviltä. Oletusportti FTP-palvelimelle on 21.

![27](https://github.com/user-attachments/assets/a78e8c97-50e5-4b97-ab63-b926d2e6c9f7)

USER nergal: ja PASS pass ovat kovakoodattuja käyttäjätunnuksia ja salasanoja, joita käytetään hyökkäyksessä. Haavoittuvassa vsftpd 2.3.4 -versiossa mikä tahansa käyttäjänimi ja salasana voivat aktivoida backdoorin.

![28](https://github.com/user-attachments/assets/e99ca419-a6be-4670-a681-399f31992e7d)

FTP-yhteyden muodostaminen. Kirjoitetaan käyttätunnus ja salasana. 

![29](https://github.com/user-attachments/assets/4c916933-4173-49e9-9a2c-f0008ad2ce3c)

Yritetään avata toinen Telnet-yhteys porttiin 6200, joka on backdoor-portti. Tämä ilmeisesti selittää sen miksi ensimmäinen yhteydenottoyritys epäonnistuu.
    
## c) Snif snif. 

![20](https://github.com/user-attachments/assets/ad10bb79-d5c7-47c8-9667-5d38d500ed51)



## d) Fuzzzz. 

Taustalla on tehtynä dirfuz-0, joten perusasetukset ovat sitä kautta jo tehtynä. Hain dirfuz-1, päivitin sille oikeudet sekä käynnistin sen.

![1](https://github.com/user-attachments/assets/6d7ae4a6-f76a-4408-8dab-1e811b11db34)

Seuraavaksi irroitin Kalin verkosta ja otin ffufin käyttöön

    ./ffuf -w common.txt -u http://127.0.0.2:8000/FUZZ

![2](https://github.com/user-attachments/assets/2c127725-a3c0-41cd-b5c1-7987e00d912e)

![3](https://github.com/user-attachments/assets/0fc92e11-8d56-46ae-8c62-3d557eabb99d)

Kuten esimerkissäkin, niin tulosteita oli paljon eikä niinkään hyödyllisiä. Katsoin mikä näille olisi yhteistä ja se vaikutti olevan 154 kokoinen tiedosto. Kokeilin siis filtteröidä nämä pois:

    ./ffuf -w common.txt -u http://127.0.0.2:8000/FUZZ -fs 154

![4](https://github.com/user-attachments/assets/73214c60-2563-4b88-93b7-6f9ca964dd45)

Lopputuloksena löytyi huomattavasti pienempi lista ja sieltä pyydetyt:

Admin page:

![5](https://github.com/user-attachments/assets/b5ed52a9-ff33-4650-9537-5769d207b1a5)

Version control related page:

![6](https://github.com/user-attachments/assets/9937b611-3de4-420c-84f6-0bf109707471)

   
## d) HTB. Ratkaise 1-2 konetta HackTheBoxisssa. 

Valitsin "Starting point" koska HackTheBox ei ollut minulle ennestään tuttu ja halusin nähdä miten se toimii. Tein sieltä kaksi ensimmäistä.

Ensimmäisessä (Meow) käytettiin kirjautumiseen telnettiä sekä root käyttäjätunnusta. Näiden avulla löysin lipun.

![10](https://github.com/user-attachments/assets/f8b7e45d-fe25-4ed0-80de-aab713c0821c)

Toisessa (Fawn) tehtävässä käytettiin ftp:n anonymous käyttäjätunnusta hyväksi lipun löytämiseen. Lippu kopioitiin ftp-serveriltä itselle.

![14](https://github.com/user-attachments/assets/975a96b6-48d6-4118-a9b0-f2ad2d7cd126)

![17](https://github.com/user-attachments/assets/b3fab667-0e7a-409c-8b8c-2df25356f9c8)

## e) Vapaaehtoinen: Vaihda 'micro' Metasploitin oletuseditoriksi. 

Vinkin setg ei minulla toiminut vaan koodi avautui VIMissä.

Seuraava komento kuitenkin tuo micron ainakin kyseiseen sessioon. Muuten en saanut oletuksena sitä mukaan automaattisesti.

    sudo EDITOR=micro msfconsole

Koitin myös tallentaa asetuksen mutta se ei taas seuraavalla kerralla näkynyt echossa eikä siten ollut käytössä.

![7](https://github.com/user-attachments/assets/188d8eaf-08b7-42a0-bd25-d3d66d6c9e94)


## f) Vapaaehtoinen: Asenna FuffMe-harjoitusmaali ja tee ratkaise sen harjoitukset. 

Karvinen 2023: Fuffme - Install Web Fuzzing Target on Debian

## g) Vapaaehtoinen: Analysoi snifferillä, miten etäkäytön parannus (session -u 1) toimii vsftpd backdoor -hyökkäyksessä.

## h) Vapaaehtoinen, vaikea: Etsi takaovi vsftpd:n lähdekoodista.
